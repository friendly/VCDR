<h1 id="visualizing-categorical-data-with-r">Visualizing categorical Data with R</h1>
<p>This document describes the file structure and conventions for the book.</p>
<h2 id="file-structure">File structure</h2>
<p>Book files: <code>book.Rnw</code> is the main source file. <code>chapter.Rnw</code> is a master file for a single chapter. Chapters are in chXX.Rnw, and are included as knitr child documents. All other files (figures, tables, R code) for a given chapter are in subdirectories, <code>chXX/{fig,tab,R}</code>.</p>
<p>I've only just begun to use sub-child documents for sections within chapters, but this works without problems.</p>
<pre><code>book.Rnw  - Main source file; compile with `knit2pdf(&quot;book.Rnw&quot;)`.  Several latex passes are needed to resolve cross-references and bibtex citations.
ch01.Rnw
ch02.Rnw
 ...
Ch09.Rnw
ch01/
   fig/
   R/
   tab/
ch02/
   fig/
   R/
   tab/
 ...
ch09/
front/  - front matter files
inputs/
   commands.tex - all LaTeX style commands (math markup, R abbreviations, examples, etc are defined here)
references.bib - current resolved reference list, extracted via aux2bib</code></pre>
<p>There is now also a chapter master file, <code>chapter.Rnw</code> for compiling a single chapter, with <code>knit2pdf(&quot;chapter.Rnw&quot;)</code>. Just before the <code>\begin{document}</code>, set the chapter number using, e.g., for Chapter 8:</p>
<pre><code>&lt;&lt;set-counters, results=&#39;asis&#39;, tidy=FALSE, echo=FALSE&gt;&gt;=
.chapter &lt;- 8
...
@
</code></pre>
<p>Then, compile with:</p>
<pre><code>knit2pdf(&quot;chapter.Rnw&quot;, output=&quot;chapter08.tex&quot;,  quiet=TRUE)</code></pre>
<h3 id="other-files-and-directories">Other files and directories:</h3>
<pre><code>chXX.Rnw - a minimal template for a new chapter
Rprofile.R - defines a function `knitrSet()` called at the start of each chapter to set the basename (chXX) and common knitr options for the chapter.

functions/ - R functions that can be `source()`d for the book.  These can be used to override 
bookplan/  - book proposal
vcd/  - source files from the SAS edition of vcd.  I crib from this as needed.
vcd-tutorial/  - files for vcdExtra vignette
Workshop/  - Exercises for my VCD short course</code></pre>
<h3 id="bibliography-files">Bibliography files:</h3>
<p>At present, I have been keeping all source <code>.bib</code> and <code>.bst</code> files in a separate <code>localtexmf</code> tree, outside VCDR. I'll have to move them here or else share a separate link.</p>
<p>Typically, I use the utility <code>aux2bib</code> to extract the relevant entries, to create a composite file, <code>references.bib</code> in the target directory, but that has to be re-done with changes to the text. This is a perl script I run on linux, and Windows (via <code>perl aux2bib book</code>)</p>
<p>At present, <code>references.bib</code> is up-to-date, and the <code>.bst</code> file, <code>abbrvnat-apa-nourl.bst</code> is included in the project root directory.</p>
<p>This points to the need for a <code>Makefile</code> for the project.</p>
<p>The <code>book.Rnw</code> file now makes it easier to switch from the separate .bib files to <code>references.bib</code>:</p>
<pre><code>\usepackage{ifthen}
\newboolean{localbibs}         % Use local .bib files or processed references.bib ??
\setboolean{localbibs}{true}   % Change to *false* to use references.bib</code></pre>
<p>Toward the end of <code>book.Rnw</code>, this is used as</p>
<pre><code>\ifthenelse{\equal{localbibs}{true}}%
  {\bibliography{graphics,statistics,timeref,Rpackages}}%
  {\bibliography{references}}</code></pre>
<h2 id="conventions-used-in-the-.rnw-files">Conventions used in the .Rnw files</h2>
<p>I've been using stylistic conventions and LaTeX commands for markup in the writing. The goal is to avoid idiosyncratic markup for font styles, etc. in the text (e.g., <code>\texttt{}</code>, <code>textbf{}</code>) so that the style of a given symbol type can be changed globally by editing <code>inputs/commands.tex</code>.</p>
<h3 id="math-commands">Math commands</h3>
<ul>
<li>Many shorthands for mathematical notation in LaTeX, e.g., <code>\mat{X}</code>, <code>\vec{v}</code>, <code>\diag{M}</code>, etc.</li>
<li>In particular, matrices and vectors are defined to use boldmath, <code>\bm{}</code>, e.g., <code>\mat{X}</code> gives <strong>X</strong>.</li>
<li>many of these use <code>\ensuremath</code>, so they can be used directly in text w/o <code>$$</code>.</li>
<li><code>\Bin</code>, <code>\Pois</code>, <code>\NBin</code> etc. defined as mathematical operators</li>
</ul>
<h3 id="labels-and-cross-references">Labels and cross-references</h3>
<ul>
<li>Prefixes for Chapter (<code>ch:</code>), section (<code>sec:</code>) labels</li>
<li>Prefixes for Figure (<code>fig:</code>), table (<code>tab:</code>) labels</li>
<li>Equation labels: <code>eq:</code></li>
<li><code>inputs/commands.tex</code> defines a complete set of macros for references to these, e.g., <code>\secref{sec:}</code>, <code>\figref{fig:}</code>, <code>tabref{tab:}</code>, <code>\exref{ex:}</code>, <code>\eqref{eq:}</code> etc.</li>
<li>Also ranges and lists of references, like <code>\figrange{fig:one}{fig:three}</code>, producing <code>Figures~\ref{#1}--\ref{#2}</code></li>
<li>Examples: automatically generate a lable of the form <code>ex:exname</code>, so use <code>exref{ex:exname}</code> to cross-reference.</li>
<li>Exercises: automatically generate a label of the form <code>lab:ch.ex</code>, so use <code>labref{lab:ch.ex}</code> to cross-reference</li>
</ul>
<p>In the draft version of the text, I'm using <code>\usepackage{showlabels}</code> to print these labels.</p>
<h3 id="r-code">R code</h3>
<ul>
<li>R code in the text: <code>\code{x &lt;- 0:3}</code>. Need to escape special characters or use <code>\verb|DF$x|</code></li>
<li>I haven't been able to find a LateX re-definition of <code>\code{}</code> that avoids the need to escape special characters.</li>
<li>Functions named in the text: <code>\func{array}</code>. These will print as &quot;array()&quot; in the text and will be automatically indexed. Need to escape special characters, e.g., <code>\func{Ord\_plot}</code>.</li>
<li>R packages: <code>\pkg{vcd}</code> or <code>\Rpackage{vcd}</code>, the latter producing &quot;vcd package&quot;. Automatically indexed.</li>
<li>Data sets: Use <code>\data{HorseKicks}</code> to mention a data set. Will be automatically indexed.</li>
</ul>
<h3 id="indexing">Indexing</h3>
<p>In addition to the automatic indexing for R stuff in the main index, I use some shorthands:</p>
<ul>
<li><code>\term{}</code> - main introduction of a technical word or phrase; prints the term in '` and adds it to the index</li>
<li><code>\ix{}</code> - add an index entry</li>
<li><code>\IX{}</code> - insert the term in the text and add an index entry</li>
<li><code>\ixmain{}</code> - flag an index entry as the main entry (printed in bold)</li>
<li><code>\ixon{}</code> and <code>\ixoff{}</code> to start and end the indexing of a topic spanning multiple pages</li>
</ul>
<p>Other indexes:</p>
<ul>
<li>Example index: index entries created automatically by the Example environment. To update this, need to run</li>
</ul>
<pre><code>makeindex -o book.ine book.ide</code></pre>
<ul>
<li>Author index: The author index can be re-created from the <code>book.aux</code> file using the following command:</li>
</ul>
<pre><code>perl authorindex book</code></pre>
<h3 id="common-abbreviations">Common abbreviations</h3>
<ul>
<li>I use <code>\etal</code>, <code>\loglin</code>, <code>\ctab</code>, <code>\scat</code> and other abbreviations to both save typing and ensure consistency in the text.</li>
</ul>
<h3 id="authors-notes-etc">Authors notes, etc</h3>
<ul>
<li>I am using <code>\TODO{}</code> to flag work to be done, either in the writing or the software</li>
<li>I mark them as <code>\DONE{}</code> when accomplished.</li>
<li>Both of these can easily be turned into no-ops to ignore the text, as noted in <code>commands.tex</code>.</li>
</ul>
<h3 id="exercises">Exercises</h3>
<p>An impoprtant feature of the book for marketing purposes is the inclusion of lab exercises for each chapter. These are now marked up as follows:</p>
<pre><code>\begin{Exercises}
  \exercise
  \exercise
  \exercise \hard
  ...
\end{Exercises}</code></pre>
<p>Each <code>\excercise</code> automatically generates a label, of the form <code>\label{lab:ch.ex}</code> that can be referenced in the text. This is dangerous, because inserting a new excercise in the middle of a list will change all subsequent numbers. It is probably better to use explicit labels, like</p>
<pre><code>\begin{Exercises}
  \exercise \label{lab:ch09-iris}
  \exercise \label{lab:ch09-foo}
  \exercise \label{lab:ch09-bar} \hard
  ...
\end{Exercises}</code></pre>
<p>There are quite a few LaTeX packages that support such exercises, and also allow including hints and solutions in the text. It would be good to find one that we can use and re-do the markup of exercises.</p>
<h2 id="compilation">Compilation</h2>
<p>I'll work on a proper <code>Makefile</code> for the project, but there is a rudimentary <code>Make.R</code> file in the project root directory containing the following main steps:</p>
<pre><code>setwd(VCDR)
knitr::knit2pdf(input = &#39;book.Rnw&#39;)
# may need to run BibTeX again sometimes... followed by pdflatex at the end
system(&quot;bibtex book&quot;)
# make other indices: example index, author index
system(&quot;makeindex -o book.ine book.ide&quot;)
system(&quot;perl authorindex -h&quot;)
# create references.bib from separate bib files under local texmf tree
system(&quot;perl aux2bib book&quot;)
system(&quot;pdflatex book&quot;)</code></pre>
<h2 id="git-branches">git Branches</h2>
<p>Here is a suggestion for using branches and workflow for editing</p>
<ul>
<li><code>master</code> - Current up-to-date draft</li>
<li><code>revision1</code> - New editing work (MF/DM)</li>
<li>design - I'd like to test out ideas for the book design (e.g., C&amp;H <code>krantz.cls</code>) in a separate branch</li>
<li>Create other branches as needed</li>
</ul>
<h3 id="workflow-for-editing">Workflow for editing</h3>
<ul>
<li><code>git checkout master</code></li>
<li><code>git fetch</code> # get any remote commits from github</li>
<li><code>git status</code> # can it be fast-forwarded?</li>
<li><p><code>git pull</code></p></li>
<li><code>git branch {new-branch-name}</code> # create new branch</li>
<li><code>git checkout {new-branch-name}</code> # switch to new branch</li>
<li>... Edit, compile, review, edit, compile, review ...</li>
<li>... <code>git add .</code></li>
<li>... <code>git commit</code> # commit to the new branch</li>
<li><p><code>git push -u origin {new-branch-name}</code> # push, and set upstream</p></li>
<li><p>... once the editing work is finished, create a pull request on github for the branch to be merged into master.</p></li>
</ul>
<p>After a pull request has been accepted and merged into master:<br />- <code>git branch -d {branch-name}</code></p>
